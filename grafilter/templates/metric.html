{% extends "base.html" %}
{% block body %}
<div class="ui one column centered grid">
	<div class="fifteen wide column">
		<div class="ui horizontal menu">
			<div class="item">
				<div class="ui breadcrumb">
					<a href="/" class="section"><i class="home icon"></i> Index</a>
					<i class="right chevron icon divider"></i>
					<div class="active section">{{ metric }}</div>
				</div>
			</div>
			<div class="right menu">
				<div class="item">
					<div class="ui transparent icon input">
						<input placeholder="Time period" type="text" id="period" name="period" class="menubarinput" value="{{ period or "" }}">
						<i class="wait icon"></i>
					</div>
				</div>
			</div>
			<div class="right menu">
				<div class="item">
					<div class="ui transparent icon input">
						<input placeholder="Start time (UTC)" type="text" id="start" name="start" class="menubarinput" value="{{ start or "" }}">
						<i class="calendar icon"></i>
					</div>
				</div>
			</div>
		</div>

		<div id="chart"><svg></svg></div>
		<script type="text/javascript">
			$(function() {
				$(".menubarinput").keypress(function(e) {
					if(e.which == 10 || e.which == 13) {
						e.preventDefault();
						var next = "/metric/{{ metric_urlsafe }}/";
						if ($("#period").val()) {
							next = next + $("#period").val() + "/";
						}
						else {
							next = next + "1h/";
						}
						if ($("#start").val()) {
							next = next + $("#start").val() + "/";
						}
						window.location.href = next;
					}
				});
			});

			nv.addGraph(function() {
				var chart = nv.models.lineChart()
				.showLegend(false)
				;

				chart.xAxis.tickFormat(function(d) {
					return d3.time.format('%H:%M:%S')(new Date(d))
				});

				chart.xScale(d3.time.scale.utc());

				var values = {{ values }};
				var xy_values = [];
				for (var i = 0, size = values.length; i < size; i++) {
					xy_values.push({x: values[i][0], y: values[i][1]});
				}
				d3.select('#chart svg').datum([{
					'color': '#009FDA',
					'key': '{{ metric }}',
					'values': xy_values,
				}]).call(chart);

				nv.utils.windowResize(function() { chart.update() });
				return chart;
			});
		</script>
	</div>
</div>
{% endblock %}
